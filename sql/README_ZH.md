# 数据库管理 SQL 脚本

本目录包含用于初始化和维护"Find My Goods"项目数据库的 SQL 脚本。

## 文件说明

1. `init.sql`: 初始化数据库架构，包括表、索引和函数。
2. `check_index_performance.sql`: 检查 IVFFlat 索引的性能。
3. `rebuild_ivfflat_index.sql`: 重建 IVFFlat 索引以优化性能。

## 使用方法

### 初始化数据库

要初始化数据库，请运行：

```bash
psql -h localhost -d 你的数据库名 -U 你的用户名 -f sql/init.sql
```

请将 `你的数据库名` 和 `你的用户名` 替换为实际的数据库名和用户名。

### 检查索引性能

要检查 IVFFlat 索引的性能，请运行：

```bash
psql -h localhost -d 你的数据库名 -U 你的用户名 -f sql/check_index_performance.sql
```

建议定期运行此脚本，特别是在数据量显著增长后，以监控索引性能。

### 重建 IVFFlat 索引

如果索引性能下降或在数据量显著增长后，重建索引：

```bash
psql -h localhost -d 你的数据库名 -U 你的用户名 -f sql/rebuild_ivfflat_index.sql
```

## 使用指南

1. **初始设置**：在设置新数据库时，始终先运行 `init.sql`。

2. **定期维护**：
   - 定期运行 `check_index_performance.sql`，特别是在添加大量新数据之后。
   - 监控此脚本报告的查询执行时间和索引大小。

3. **索引优化**：
   - 如果您注意到查询性能显著下降，或者数据量大幅增加（例如增长了10倍），请考虑重建索引。
   - 使用 `rebuild_ivfflat_index.sql` 重建索引。您可能需要根据数据大小和分布调整脚本中的 `lists` 参数。

4. **数据量考虑**：
   - IVFFlat 索引在较大的数据集上表现更好。对于小数据集，初始的"低召回率"警告是正常的。
   - 随着数据量的增长，索引性能应自然改善。

5. **性能调优**：
   - 如果即使在重建索引后仍然遇到性能问题，请考虑咨询数据库性能专家。
   - 您可能需要调整其他数据库参数或进一步优化查询。

6. **备份**：在运行任何维护脚本之前，特别是在重建索引之前，务必备份您的数据库。

## 注意事项

这些脚本是为安装了 pgvector 扩展的 PostgreSQL 数据库设计的。在运行脚本之前，请确保您的数据库设置符合这些要求。

如遇任何问题或需要进一步定制，请咨询项目的技术负责人或数据库管理员。